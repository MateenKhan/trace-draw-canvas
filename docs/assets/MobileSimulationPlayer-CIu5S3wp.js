import{r as a,j as e,a as _,X as z,t as N}from"./index-CJSvXW5C.js";import{D as T,g as O,e as A,A as B,j as G,B as x,R as I,P as U,m as D}from"./Index-B1hgXDGJ.js";import{S as X,P as H,a as W}from"./skip-forward-DEWUSFQj.js";const Q=({isVisible:m,onClose:k,toolPaths:r,onSimulationChange:f})=>{const[p]=a.useState(T),[n,u]=a.useState(!1),[i,c]=a.useState(0),[b,g]=a.useState(0);a.useState(!1);const l=a.useRef(null),y=a.useRef(null),j=O(r,p),o=j.split(`
`),S=A(r,p),v=r.flatMap(s=>s.points),w=v.length,h=w>0?v[Math.min(Math.floor(i/100*w),w-1)]:null;a.useEffect(()=>{f==null||f({isPlaying:n,progress:i,currentLine:b,currentPoint:h,showOverlay:m})},[n,i,b,h,m,f]),a.useEffect(()=>{if(!n||o.length===0){l.current&&(clearInterval(l.current),l.current=null);return}return l.current=setInterval(()=>{g(s=>{const t=s+1;return t>=o.length?(u(!1),c(100),s):(c(t/o.length*100),t)})},80),()=>{l.current&&(clearInterval(l.current),l.current=null)}},[n,o.length]),a.useEffect(()=>{m||u(!1)},[m]);const M=()=>u(!0),R=()=>u(!1),E=()=>{u(!1),c(0),g(0)},P=()=>{g(s=>Math.min(s+10,o.length-1)),c(s=>Math.min(s+5,100))},L=()=>{g(s=>Math.max(s-10,0)),c(s=>Math.max(s-5,0))},C=s=>{const t=s[0];c(t),g(Math.floor(t/100*o.length))},F=()=>{const s=new Blob([j],{type:"text/plain"}),t=URL.createObjectURL(s),d=document.createElement("a");d.href=t,d.download="toolpath.gcode",d.style.display="none",/iPhone|iPad|iPod/i.test(navigator.userAgent)&&/Safari/i.test(navigator.userAgent)?(window.open(t,"_blank"),N.success("G-code opened in new tab - use Share > Save to Files")):(document.body.appendChild(d),d.click(),document.body.removeChild(d),N.success("G-code exported successfully")),setTimeout(()=>URL.revokeObjectURL(t),5e3)};return m?e.jsxs("div",{ref:y,className:"fixed inset-0 z-[300] bg-black flex flex-col",children:[e.jsxs("div",{className:"flex-1 relative flex items-center justify-center overflow-hidden bg-gray-950",children:[r.length>0?e.jsxs(e.Fragment,{children:[e.jsx(B,{toolPaths:r,progress:i,currentPoint:h,isPlaying:n,width:window.innerWidth,height:window.innerHeight-100,show:!0}),e.jsxs("div",{className:"absolute top-4 left-4 flex items-center gap-1 bg-black/60 px-2 py-1 rounded backdrop-blur-sm",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-white"}),e.jsx("span",{className:"text-[10px] text-white/70",children:"Origin (0,0)"})]})]}):e.jsxs("div",{className:"text-white/60 text-center p-8",children:[e.jsx("p",{className:"text-lg mb-2",children:"No toolpaths available"}),e.jsx("p",{className:"text-sm",children:"Add shapes to the canvas to generate toolpaths"})]}),h&&e.jsx("div",{className:"absolute top-4 right-4 px-2 py-1 bg-black/60 rounded backdrop-blur-sm",children:e.jsxs("div",{className:"text-[10px] font-mono text-white",children:["X:",h.x.toFixed(1)," Y:",h.y.toFixed(1)]})})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black/90 backdrop-blur-md border-t border-white/10 px-3 py-2 pb-safe shrink-0",children:[e.jsx("div",{className:"mb-2",children:e.jsx(G,{value:[i],onValueChange:C,min:0,max:100,step:.1,className:"w-full h-1 [&_[role=slider]]:w-3 [&_[role=slider]]:h-3 [&_[role=slider]]:bg-white [&_[role=slider]]:border-0 [&_.range]:bg-green-500"})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2 min-w-[60px]",children:e.jsxs("span",{className:"text-[10px] text-white/60 font-mono",children:[(i/100*S).toFixed(1),"m"]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/10 w-8 h-8",onClick:E,children:e.jsx(I,{className:"w-4 h-4"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/10 w-8 h-8",onClick:L,children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx(x,{size:"icon",className:_("w-12 h-12 rounded-full",n?"bg-green-500 hover:bg-green-600":"bg-white hover:bg-white/90"),onClick:n?R:M,children:n?e.jsx(H,{className:"w-5 h-5 text-white"}):e.jsx(U,{className:"w-5 h-5 text-black ml-0.5"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/10 w-8 h-8",onClick:P,children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/10 w-8 h-8",onClick:F,disabled:r.length===0,children:e.jsx(D,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex items-center gap-1 min-w-[60px] justify-end",children:e.jsx(x,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/10 w-8 h-8",onClick:k,children:e.jsx(z,{className:"w-4 h-4"})})})]})]})]}):null};export{Q as MobileSimulationPlayer};
